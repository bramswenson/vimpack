#!/usr/bin/env ruby

require 'rubygems'
require 'bundler/setup'
begin
  require 'vimpack'
rescue LoadError => e
  $LOAD_PATH.unshift(File.join(File.dirname(__FILE__), '..', 'lib'))
  require 'vimpack'
end

USAGE = <<-EOU
Manage bundles of vim scripts and vimrc

Usage:
       vimpack <subcommand>
       vimpack init - Initalize vimpack repository
EOU

SUB_COMMANDS = %w{ init search install }
global_opts = Trollop::options do
  version 'vimpack 0.0.1 (c) 2011 Bram Swenson'
  banner USAGE
  stop_on SUB_COMMANDS
end

cmd = ARGV.shift
unless SUB_COMMANDS.include?(cmd)
  Trollop::die USAGE
end

case cmd
when 'init'
  options = Trollop::options do
    banner 'Initialize vimpack repository'
    opt :home_directory, 'The home directory of the user', :short => '-d', :default => ENV['HOME']
  end
  Vimpack::Commands::Init.run(options, ARGV)
when 'search'
  options = Trollop::options do
    banner 'Search for vim scripts'
  end
  Vimpack::Commands::Search.run(options, ARGV)
when 'install'
  options = Trollop::options do
    banner 'Install for vim scripts'
  end
  Vimpack::Commands::Install.run(options, ARGV)
else
  Trollop::die USAGE
end

